<div class="animated fadeIn">
  <!--<snippet-bar-hero-points></snippet-bar-hero-points>--><!-- Snippet for hero points (four circles) -->
  <div class="row"> <!-- second row -->
    <div class="col-md-6 col-xl-3"> <!-- Hero points gain charts -->
      <div *ngFor="let widget of widgetList"> <!-- Points gain line graph -->
        <!--<widget-graph *ngIf="widget.type == 'graph'"
          [graphName]="widget.name"
          [graphTitle]="widget.title"
          [graphIcon]="widget.icon"
          [dataType]="widget.dataType">
        </widget-graph>-->
      </div> <!-- let widget of widgetList -->
      <div class="card"> <!-- Points gain by week charts -->
        <div class="card-block">
          <div class="row">
            <div class="col-12">
              <h5 class="card-title float-left mb-0">Points Gain by Week</h5>
            </div> <!--/.col-->
          </div> <!--/.row-->
          <div class="chart-wrapper">
            <ul class="horizontal-bars type-2">
              <li> <!-- This Week -->
                <span class="title">This Week</span>
                <span class="value">{{ transactionListWeek | filterBy: ['weekId']: (transactionListWeek | pluck: 'weekId' | max) | pluck: 'pointsEarned' }}<span class="text-muted small"> ({{( transactionListWeek | filterBy: ['weekId']: (transactionListWeek | pluck: 'weekId' | max) | pluck: 'pointsEarned' ) / ( transactionListWeek | pluck: 'pointsEarned' | max ) | percent:'1.0-0' }})</span></span>
                <div class="bars">
                  <div class="progress" style="height: 6px;">
                    <div class="progress-bar bg-success" role="progressbar"
                    style="width: 39%" aria-valuemin="0" aria-valuemax="100"></div>
                  </div> <!-- progress -->
                </div> <!-- bars -->
              </li>
              <li> <!-- Last Week -->
                <span class="title">Last Week</span>
                <span class="value">{{ transactionListWeek | filterBy: ['weekId']: (transactionListWeek | pluck: 'weekId' | max) - 1 | pluck: 'pointsEarned' }}<span class="text-muted small"> ({{( transactionListWeek | filterBy: ['weekId']: (transactionListWeek | pluck: 'weekId' | max) - 1 | pluck: 'pointsEarned' ) / ( transactionListWeek | pluck: 'pointsEarned' | max ) | percent:'1.0-0' }})</span></span>
                <div class="bars">
                  <div class="progress" style="height: 6px;">
                    <div class="progress-bar bg-success" role="progressbar"
                    style="width: 100%" aria-valuemin="0" aria-valuemax="100"></div>
                  </div> <!-- progress -->
                </div> <!-- bars -->
              </li>
              <li> <!-- Week Maximum -->
                <span class="title">Week Maximum</span>
                <span class="value">{{ transactionListWeek | pluck: 'pointsEarned' | max }}<span class="text-muted small"> (100%)</span></span>
                <div class="bars">
                  <div class="progress" style="height: 6px;">
                    <div class="progress-bar bg-success" role="progressbar"
                    style="width: 100%" aria-valuemin="0" aria-valuemax="100"></div>
                  </div> <!-- progress -->
                </div> <!-- bars -->
              </li>
              <li> <!-- Weekly Average -->
                <span class="title">Weekly Average</span>
                <span class="value">{{ ((transactionListWeek | pluck: 'pointsEarned' | sum) / (transactionListWeek.length)) | round }}<span class="text-muted small"> ({{ (((transactionListWeek | pluck: 'pointsEarned' | sum) / (transactionListWeek.length)) | round ) / ( transactionListWeek | pluck: 'pointsEarned' | max ) | percent:'1.0-0' }})</span></span>
                <div class="bars">
                  <div class="progress" style="height: 6px;">
                    <div class="progress-bar bg-success" role="progressbar"
                    style="width: 51%" aria-valuemin="0" aria-valuemax="100"></div>
                  </div> <!-- progess -->
                </div> <!-- bars -->
              </li>
            </ul> <!-- horizontal-bars -->
          </div> <!-- chart-wrapper -->
        </div> <!-- card-block -->
      </div> <!-- card -->
    </div> <!-- col -->
    <div class="col-md-6 col-xl-3"> <!-- Leaderboard -->
      <div *ngIf="!noUserList">
        <table class="table table-striped table-hover"> <!-- Leaderboard Table -->
          <thead>
            <tr>
              <th>Rank</th>
              <th>Name</th>
              <th>Hero Points</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of userList | orderBy: '-heroPoints' | paginate: paginateLeadConfig; let i = index" [ngStyle]="{'background-color': user.userId === 1 ? '#F39C12': 'auto', 'color': user.userId === 1 ? '#ffffff': 'auto'}">
              <td>{{ i + 1 + (paginateLeadConfig.itemsPerPage * paginateLeadConfig.currentPage) - paginateLeadConfig.itemsPerPage }}</td> <!-- uses page number and number of pages to calculate the rankings -->
              <td>{{ user.displayName }}</td> <!-- Display Name -->
              <td>{{ user.heroPoints }}</td> <!-- Hero Points -->
            </tr>
          </tbody>
        </table>
        <pagination-template #p="paginationApi" [id]="paginateLeadConfig.id" (pageChange)="paginateLeadConfig.currentPage = $event"> <!-- Leaderboard pagination -->
          <ul class="pagination">
             <li class="page-item" [class.disabled]="p.isFirstPage()">
               <a class="page-link clickable" *ngIf="!p.isFirstPage()" (click)="p.previous()">Prev</a>
             </li>
             <li *ngFor="let page of p.pages" class="page-item" [class.active]="p.getCurrent() === page.value">
                <a class="page-link clickable" (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value">
                    <span>{{ page.label }}</span>
                </a>
                <div class="page-link" *ngIf="p.getCurrent() === page.value">
                    <span>{{ page.label }}</span>
                </div>
            </li>
            <li class="page-item" [class.disabled]="p.isLastPage()">
              <a class="page-link clickable" *ngIf="!p.isLastPage()" (click)="p.next()">Next</a>
            </li>
          </ul>
        </pagination-template>
      </div> <!-- if !noUserList -->
      <div *ngIf="noUserList" class="card-block">
          No Leaderboard available.
      </div> <!-- if noUserList -->
    </div>
    <div class="col-md-6 col-xl-6"> <!-- Medal Table -->
      <div *ngIf="!noMedalList">
        <table class="table header-fixed">
          <thead>
            <tr>
              <th class="col-3">Medal</th>
              <th class="col-9">Description</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let groupNo of medalList | unique: 'medalGroupId'; let i = index"> <!-- ngFor each group of medals (global) -->
              <ng-container *ngIf="(medalList | filterBy: ['title']: groupNo.title: search: true).length > 1"> <!-- if the group is longer than 1 -->
                <!-- *ngIf 'global' medal and is/isn't expanded (headers)-->
                <tr *ngIf="groupNo.expanded && groupNo.medalType == 'global'" (click)="groupNo.expanded = false" [ngStyle]="{'background-color': '#20A8D8', 'color': '#ffffff' }">
                  <td class="col-3">{{groupNo.title}}</td>
                  <td class="col-6">Click to collapse</td>
                  <td class="col-1">-</td>
                  <td class="col-2" [ngStyle]="{'text-align': 'right'}">{{ ((medalList | filterBy: ['medalType']: 'global' | filterBy: ['title']: groupNo.title: search: true) | filterBy: ['unlocked']: true).length }}/{{ (medalList | filterBy: ['medalType']: 'global'| filterBy: ['title']: groupNo.title: search: true).length }}</td>
                </tr>
                <tr *ngIf="!groupNo.expanded && groupNo.medalType == 'global'" (click)="groupNo.expanded = true" [ngStyle]="{'background-color': '#20A8D8', 'color': '#ffffff' }">
                  <td class="col-3">{{groupNo.title}}</td>
                  <td class="col-6">Click to expand</td>
                  <td class="col-1">+</td>
                  <td class="col-2" [ngStyle]="{'text-align': 'right'}"> {{ ((medalList | filterBy: ['medalType']: 'global' | filterBy: ['title']: groupNo.title: search: true) | filterBy: ['unlocked']: true).length }}/{{ (medalList | filterBy: ['medalType']: 'global'| filterBy: ['title']: groupNo.title: search: true).length }}</td>
                </tr>
                <!-- display actual medals -->
                <ng-container *ngFor="let medal of medalList | orderBy: ['+medalGroupId', '+reward']"> <!-- list each medal in each group, ordered by rewards, ascending order -->
                  <tr *ngIf="groupNo.expanded && medal.medalGroupId == i && groupNo.medalType == 'global'" [ngStyle]="{'background-color':medal.unlocked === true ? '#89DD73' : '#F25F5F', 'color': '#ffffff' }">
                    <td class="col-3">{{ medal.title }}</td>
                    <td class="col-7">{{ medal.description }}</td>
                    <td class="col-2" [ngStyle]="{'text-align': 'right'}">0/{{ medal.valueRequired }}</td> <!-- progress -->
                  </tr>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="(medalList | filterBy: ['title']: groupNo.title: search: true).length == 1"> <!-- if there is only one medal in the group, just display medal, no header -->
                <ng-container *ngFor="let medal of medalList | orderBy: ['+medalGroupId', '+reward']"> <!-- Unnecessary loop because there is only one medal in each group -->
                  <tr *ngIf="medal.medalGroupId == i && groupNo.medalType == 'global'" [ngStyle]="{'background-color':medal.unlocked === true ? '#89DD73' : '#F25F5F', 'color': '#ffffff' }">
                    <td class="col-3">{{ medal.title }}</td> <!-- medal name -->
                    <td class="col-7">{{ medal.description }}</td> <!-- medal description -->
                    <td class="col-2" [ngStyle]="{'text-align': 'right'}">0/{{ medal.valueRequired }}</td> <!-- progress -->
                  </tr>
                </ng-container>
              </ng-container>
            </ng-container> <!-- ngFor each group of medals (global) -->
            <ng-container *ngFor="let organisation of organisationList | orderBy: '+name'; let orgI = index"> <!-- ngFor organisation of organisationList -->
              <!-- ngIf organisation is/isn't expanded display correct header -->
              <tr *ngIf="organisation.expanded" (click)="organisation.expanded = false" [ngStyle]="{'background-color': '#F39C12', 'color': '#ffffff' }">
                <td class="col-3">{{organisation.name}}</td>
                <td class="col-6">Click to collapse</td>
                <td class="col-1">-</td>
                <td class="col-2" [ngStyle]="{'text-align': 'right'}">{{ (medalList | filterBy: ['medalType']: 'organisation' | filterBy: ['unlocked']: true).length }}/{{ (medalList | filterBy: ['medalType']: 'organisation').length }}</td>
              </tr>
              <tr *ngIf="!organisation.expanded" (click)="organisation.expanded = true" [ngStyle]="{'background-color': '#F39C12', 'color': '#ffffff' }">
                <td class="col-3">{{organisation.name}}</td>
                <td class="col-6">Click to expand</td>
                <td class="col-1">+</td>
                <td class="col-2" [ngStyle]="{'text-align': 'right'}">{{ (medalList | filterBy: ['medalType']: 'organisation' | filterBy: ['unlocked']: true).length }}/{{ (medalList | filterBy: ['medalType']: 'organisation').length }}</td>
              </tr>
              <ng-container *ngFor="let groupNo of medalList | unique: 'medalGroupId'; let i = index"> <!-- ngFor each group of medals (organisation) -->
                <ng-container *ngIf="(medalList | filterBy: ['title']: groupNo.title: search: true).length > 1"> <!-- ngIf length of group is more than 1 -->
                  <!-- ngIf organisation is/isn't expanded -->
                  <tr *ngIf="organisation.expanded && groupNo.expanded && groupNo.medalType == 'organisation'" (click)="groupNo.expanded = false" [ngStyle]="{'background-color': '#20A8D8', 'color': '#ffffff' }">
                    <td class="col-3">{{groupNo.title}}</td>
                    <td class="col-6">Click to collapse</td>
                    <td class="col-1">-</td>
                    <td class="col-2" [ngStyle]="{'text-align': 'right'}">{{ ((medalList | filterBy: ['medalType']: 'organisation' | filterBy: ['title']: groupNo.title: search: true) | filterBy: ['unlocked']: true).length }}/{{ (medalList | filterBy: ['medalType']: 'organisation'| filterBy: ['title']: groupNo.title: search: true).length }}</td>
                  </tr>
                  <tr *ngIf="organisation.expanded && !groupNo.expanded && groupNo.medalType == 'organisation'" (click)="groupNo.expanded = true" [ngStyle]="{'background-color': '#20A8D8', 'color': '#ffffff' }">
                    <td class="col-3">{{groupNo.title}}</td>
                    <td class="col-6">Click to expand</td>
                    <td class="col-1">+</td>
                    <td class="col-2" [ngStyle]="{'text-align': 'right'}">{{ ((medalList | filterBy: ['medalType']: 'organisation' | filterBy: ['title']: groupNo.title: search: true) | filterBy: ['unlocked']: true).length }}/{{ (medalList | filterBy: ['medalType']: 'organisation'| filterBy: ['title']: groupNo.title: search: true).length }}</td>
                  </tr>
                  <ng-container *ngFor="let medal of medalList | orderBy: ['+medalGroupId', '+reward']">
                    <tr *ngIf="organisation.expanded && groupNo.expanded && medal.medalGroupId == i && groupNo.medalType == 'organisation'" [ngStyle]="{'background-color':medal.unlocked === true ? '#89DD73' : '#F25F5F', 'color': '#ffffff' }">
                      <td class="col-3">{{ medal.title }}</td>
                      <td class="col-7">{{ medal.description }}</td>
                      <td class="col-2" [ngStyle]="{'text-align': 'right'}">0/{{ medal.valueRequired }}</td>
                    </tr>
                  </ng-container>
                </ng-container>
                <ng-container *ngIf="(medalList | filterBy: ['title']: groupNo.title: search: true).length <= 1"> <!-- ngIf length or group is <= 1 -->
                  <ng-container *ngFor="let medal of medalList | orderBy: ['+medalGroupId', '+reward']">
                    <tr *ngIf="organisation.expanded && medal.medalGroupId == i && groupNo.medalType == 'organisation'" [ngStyle]="{'background-color':medal.unlocked === true ? '#89DD73' : '#F25F5F', 'color': '#ffffff' }">
                      <td class="col-3">{{ medal.title }}</td>
                      <td class="col-7">{{ medal.description }}</td>
                      <td class="col-2" [ngStyle]="{'text-align': 'right'}">0/{{ medal.valueRequired }}</td>
                    </tr>
                  </ng-container>
                </ng-container>
              </ng-container> <!-- ngFor each group of medals (organisation) -->
            </ng-container> <!-- ngFor organisation of organisationList -->
          </tbody>
        </table>
      </div> <!-- if !noMedalList -->
      <div *ngIf="noMedalList" class="card-block">
          No Leaderboard available.
      </div> <!-- if noMedalList -->
    </div>
  </div><!-- Row -->
  <div *ngFor="let group of globalMedalList">
    <div *ngFor="let threshold of group.group_name | pluck: 'threshold'">
    </div>
  </div>
  <div *ngFor="let medals of testList">
    <div *ngFor="let group of medals | values; let groupIndex = index">
      <div>threshold length - total      {{(group[0] | values).length - 1}}</div>
      <div>group_title      {{(medals | keys)[groupIndex]}}</div>
      <div>All awarded values for group {{group[0] | values | filterBy: ['awarded']: 'true' | pluck: 'awarded' | json}}</div>
      <div *ngFor="let thresholds of group[0] | values">
        <div *ngIf="thresholds | isObject">
          <div>9 {{thresholds | json}}</div>
        </div>
      </div>
    </div>
  </div>
</div>
